---
title: Выражение switch в справочнике по C#
description: Сведения о выражении switch в C#, которое реализует аналогичную switch семантику на основе сопоставления шаблонов.
ms.date: 04/16/2021
f1_keywords:
- switch_CSharpKeyword
helpviewer_keywords:
- switch expression [C#]
- pattern matching [C#]
ms.openlocfilehash: ce892598f364e4934613a797d9290fa385abd4c8
ms.sourcegitcommit: 23e2bc267872ce6ea22db4bf6478fe57bcba4bc8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2021
ms.locfileid: "107592270"
---
# <a name="switch-expression-c-reference"></a>Выражение switch (справочник по C#)

Начиная с версии C# 8.0, вы можете использовать `switch`, чтобы вычислить какое-то одно выражение из списка кандидатов, основываясь на сопоставлении шаблонов по входному выражению. Дополнительные сведения об операторе `switch`, который поддерживает семантику, аналогичную `switch`, в контексте оператора, см. в статье об [операторе `switch`](../keywords/switch.md).

В следующем примере демонстрируется выражение `switch`, которое преобразует значения [`enum`](../builtin-types/enum.md), представляющие визуальные направления на интерактивной карте, в соответствующие стороны света.

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="SnippetBasicStructure":::

В предыдущем примере показаны основные элементы выражения `switch`.

- Выражение, за которым следует ключевое слово `switch`. В предыдущем примере это параметр метода `direction`.
- *Ветви выражения `switch`* , разделенные запятыми. Каждая ветвь выражения `switch` содержит *шаблон*, необязательное [*охранное условие*](#case-guards), маркер `=>` и *выражение*.

В предыдущем примере выражение `switch` использует следующие шаблоны.

- [Шаблон константы](patterns.md#constant-pattern), используемый для обработки определенных значений перечисления `Direction`.
- [Шаблон пустой переменной](patterns.md#discard-pattern), используемый для обработки любых целочисленных значений, которые не имеют соответствующих элементов в перечислении `Direction` (например, `(Direction)10`). Это делает выражение `switch` [исчерпывающим](#non-exhaustive-switch-expressions).

Сведения о шаблонах, поддерживаемых выражением `switch`, см. в статье [Шаблоны](patterns.md).

Результатом выражения `switch` является значение выражения первой ветви `switch`, чей шаблон соответствует входному выражению, а охранное условие, если таковое есть, принимает значение `true`. Ветви выражения `switch` вычисляются в том порядке, в котором они приведены в тексте.

Когда выбрать идущую ниже ветвь выражения `switch` невозможно, так как идущая выше ветвь `switch` соответствует всем значениям этого выражения, компилятор выдает ошибку.

## <a name="case-guards"></a>Охранные условия

Шаблон может недостаточно полно выражать условие вычисления выражения ветви. В этом случае можно использовать охранное условие. Это дополнительное условие, которое должно выполняться помимо соответствия шаблону. Охранное условие указывается после ключевого слова `when`, идущего за шаблоном, как показано в следующем примере.

:::code language="csharp" source="snippets/shared/SwitchExpressions.cs" id="CaseGuardExample":::

В предыдущем примере используются [шаблоны свойств](patterns.md#property-pattern) с вложенными [шаблонами var](patterns.md#var-pattern).

## <a name="non-exhaustive-switch-expressions"></a>Неисчерпывающие выражения switch

Если ни один из шаблонов выражения `switch` не соответствует входному значению, среда выполнения выдает исключение. В .NET Core 3.0 и более поздних версиях исключением является <xref:System.Runtime.CompilerServices.SwitchExpressionException?displayProperty=nameWithType>. В .NET Framework исключением является <xref:System.InvalidOperationException>. Если выражение `switch` не обрабатывает все возможные входные значения, компилятор генерирует предупреждение.

> [!TIP]
> Чтобы гарантировать, что выражение `switch` обработает все возможные входные значения, укажите ветвь выражения `switch` с [шаблоном пустой переменной](patterns.md#discard-pattern).

## <a name="c-language-specification"></a>Спецификация языка C#

Дополнительные сведения см. в разделе о [выражении `switch`](~/_csharplang/proposals/csharp-8.0/patterns.md#switch-expression) в этой [заметке о предлагаемых функциях](~/_csharplang/proposals/csharp-8.0/patterns.md).

## <a name="see-also"></a>См. также раздел

- [справочник по C#](../index.md)
- [Операторы и выражения C#](index.md)
- [Шаблоны](patterns.md)
- [Учебник. Использование сопоставления шаблонов для создания управляемых типами и управляемых данными алгоритмов](../../tutorials/pattern-matching.md)
- [Инструкция `switch`](../keywords/switch.md)
