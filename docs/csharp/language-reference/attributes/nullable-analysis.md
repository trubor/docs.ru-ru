---
title: 'Зарезервированные атрибуты C#: статический анализ типов, допускающих значения NULL'
ms.date: 02/02/2021
description: Компилятор интерпретирует эти атрибуты для более эффективного статического анализа ссылочных типов, допускающих значения NULL и не допускающих значения NULL.
ms.openlocfilehash: 91bba16506e2e8bbac9fdef2d1c4badcf59c1546
ms.sourcegitcommit: 10e719780594efc781b15295e499c66f316068b8
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/14/2021
ms.locfileid: "100432573"
---
# <a name="reserved-attributes-contribute-to-the-compilers-null-state-static-analysis"></a><span data-ttu-id="4fd52-103">Зарезервированные атрибуты используются для статического анализа состояния NULL компилятора.</span><span class="sxs-lookup"><span data-stu-id="4fd52-103">Reserved attributes contribute to the compiler's null state static analysis</span></span>

<span data-ttu-id="4fd52-104">В контексте, допускающем значения NULL, компилятор выполняет статический анализ кода для определения состояния со значением NULL всех переменных ссылочного типа.</span><span class="sxs-lookup"><span data-stu-id="4fd52-104">In a nullable context, the compiler performs static analysis of code to determine the null state of all reference type variables:</span></span>

- <span data-ttu-id="4fd52-105">*Значение, отличное от NULL*. Статический анализ определяет, что переменной присвоено значение, отличное от NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-105">*not null*: Static analysis determines that a variable is assigned a non-null value.</span></span>
- <span data-ttu-id="4fd52-106">*Может иметь значение NULL*. Статический анализ не может определить, что переменной присвоено значение, отличное от NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-106">*maybe null*: Static analysis can't determine that a variable is assigned a non-null value.</span></span>

<span data-ttu-id="4fd52-107">Можно применить атрибуты, предоставляющие компилятору сведения о семантике API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-107">You can apply attributes that provide information to the compiler about the semantics of your APIs.</span></span> <span data-ttu-id="4fd52-108">Эти сведения помогают компилятору выполнять статический анализ и определять, когда переменная не имеет значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-108">That information helps the compiler perform static analysis and determine when a variable isn't null.</span></span> <span data-ttu-id="4fd52-109">В этой статье приводится краткое описание каждого из этих атрибутов и рассматриваются способы их использования.</span><span class="sxs-lookup"><span data-stu-id="4fd52-109">This article provides a brief description of each of those attributes and how to use them.</span></span> <span data-ttu-id="4fd52-110">Во всех примерах предполагается, что используется C# 8.0 или более поздняя версия, а код находится в контексте, допускающем значения NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-110">All the examples assume C# 8.0 or newer, and the code is in a nullable context.</span></span>

<span data-ttu-id="4fd52-111">Начнем со знакомого примера.</span><span class="sxs-lookup"><span data-stu-id="4fd52-111">Let's start with a familiar example.</span></span> <span data-ttu-id="4fd52-112">Представьте, что библиотека содержит следующий API для получения строки ресурса.</span><span class="sxs-lookup"><span data-stu-id="4fd52-112">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="4fd52-113">В предыдущем примере применяется знакомый шаблон `Try*` в .NET.</span><span class="sxs-lookup"><span data-stu-id="4fd52-113">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="4fd52-114">Для этого API существует два ссылочных аргумента: `key` и параметр `message`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-114">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="4fd52-115">У этого API есть следующие правила, относящиеся к значениям NULL этих аргументов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-115">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="4fd52-116">Вызывающие объекты не должны передавать `null` в качестве аргумента для `key`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-116">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="4fd52-117">Вызывающие объекты могут передавать переменную, значение которой равно `null`, в качестве аргумента для `message`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-117">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="4fd52-118">Если метод `TryGetMessage` возвращает `true`, значение `message` не равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-118">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="4fd52-119">Если возвращаемое значение равно `false,`, значение `message` (и его состояние со значением NULL) равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-119">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="4fd52-120">Правило для `key` может быть выражено типом переменной: `key` должен быть ссылочным типом, не допускающим значения NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-120">The rule for `key` can be expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="4fd52-121">Параметр `message` является более сложным.</span><span class="sxs-lookup"><span data-stu-id="4fd52-121">The `message` parameter is more complex.</span></span> <span data-ttu-id="4fd52-122">Он допускает использование `null` в качестве аргумента, но гарантирует, что в случае успеха аргумент `out` не будет иметь значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-122">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="4fd52-123">В таких случаях требуется более широкое описание ожиданий.</span><span class="sxs-lookup"><span data-stu-id="4fd52-123">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="4fd52-124">Для выражения дополнительных сведений о состоянии NULL для переменных добавлено несколько атрибутов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-124">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="4fd52-125">Весь код, написанный до ввода ссылочных типов, допускающих значение NULL, в C# версии 8, *игнорировал допустимость значений NULL*.</span><span class="sxs-lookup"><span data-stu-id="4fd52-125">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="4fd52-126">Это означает, что любая переменная ссылочного типа может принимать значение NULL, но проверки значений NULL не требуются.</span><span class="sxs-lookup"><span data-stu-id="4fd52-126">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="4fd52-127">Но если код *допускает значения NULL*, эти правила меняются.</span><span class="sxs-lookup"><span data-stu-id="4fd52-127">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="4fd52-128">Ссылочные типы никогда не должны быть значением `null`, а ссылочные типы, допускающие значения NULL, перед разыменованием должны проверяться на наличие `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-128">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="4fd52-129">Правила для API-интерфейсов, по всей вероятности, более сложны, как было показано в сценарии `TryGetValue` API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-129">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="4fd52-130">Для многих API действуют более сложные правила в отношении того, когда переменные могут или не могут иметь значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-130">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="4fd52-131">В таких случаях для выражения этих правил используется один из следующих атрибутов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-131">In these cases, you'll use one of the following attributes to express those rules:</span></span>

- <span data-ttu-id="4fd52-132">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute). Входной аргумент, не допускающий значение NULL, может принимать значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-132">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="4fd52-133">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute). Входной аргумент, допускающий значение NULL, никогда не должен принимать значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-133">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>
- <span data-ttu-id="4fd52-134">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute). Возвращаемое значение, не допускающее значение NULL, может быть равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-134">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="4fd52-135">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute). Возвращаемое значение, допускающее значение NULL, никогда не будет равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-135">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>
- <span data-ttu-id="4fd52-136">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute). Входной аргумент, не допускающий значение NULL, может иметь значение NULL, если метод возвращает указанное значение `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-136">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable input argument may be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="4fd52-137">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute). Входной аргумент, допускающий значение NULL, не будет иметь значение NULL, если метод возвращает указанное значение `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-137">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable input argument won't be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="4fd52-138">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute). Возвращаемое значение не равно NULL, если аргумент для указанного параметра не равен NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-138">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the argument for the specified parameter isn't null.</span></span>
- <span data-ttu-id="4fd52-139">[DoesNotReturn](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnAttribute). Метод никогда не возвращает значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-139">[DoesNotReturn](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnAttribute): A method never returns.</span></span> <span data-ttu-id="4fd52-140">Другими словами, он всегда создает исключение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-140">In other words, it always throws an exception.</span></span>
- <span data-ttu-id="4fd52-141">[DoesNotReturnIf](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnIfAttribute). Этот метод никогда не возвращает значение, если связанный параметр `bool` имеет указанное значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-141">[DoesNotReturnIf](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnIfAttribute): This method never returns if the associated `bool` parameter has the specified value.</span></span>
- <span data-ttu-id="4fd52-142">[MemberNotNull.](xref:System.Diagnostics.CodeAnalysis.MemberNotNullAttribute) Если метод возвращает значение, включенный в список элемент не будет иметь значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-142">[MemberNotNull](xref:System.Diagnostics.CodeAnalysis.MemberNotNullAttribute): The listed member won't be null when the method returns.</span></span>
- <span data-ttu-id="4fd52-143">[MemberNotNullWhen.](xref:System.Diagnostics.CodeAnalysis.MemberNotNullWhenAttribute) Если метод возвращает указанное значение `bool`, включенный в список элемент не будет иметь значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-143">[MemberNotNullWhen](xref:System.Diagnostics.CodeAnalysis.MemberNotNullWhenAttribute): The listed member won't be null when the method returns the specified `bool` value.</span></span>

<span data-ttu-id="4fd52-144">Приведенные выше сведения лишь кратко описывают каждый атрибут.</span><span class="sxs-lookup"><span data-stu-id="4fd52-144">The preceding descriptions are a quick reference to what each attribute does.</span></span> <span data-ttu-id="4fd52-145">В каждом следующем разделе действия и значения атрибутов рассматриваются более подробно.</span><span class="sxs-lookup"><span data-stu-id="4fd52-145">Each following section describes the behavior and meaning more thoroughly.</span></span>

<span data-ttu-id="4fd52-146">При добавлении этих атрибутов компилятор получает дополнительные сведения о правилах для API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-146">Adding these attributes gives the compiler more information about the rules for your API.</span></span> <span data-ttu-id="4fd52-147">Если вызывающий код компилируется в контексте, допускающем значение NULL, и вызывающие объекты нарушают эти правила, компилятор выведет соответствующие предупреждения.</span><span class="sxs-lookup"><span data-stu-id="4fd52-147">When calling code is compiled in a nullable enabled context, the compiler will warn callers when they violate those rules.</span></span> <span data-ttu-id="4fd52-148">Эти атрибуты не используются для выполнения дополнительных проверок в вашей реализации.</span><span class="sxs-lookup"><span data-stu-id="4fd52-148">These attributes don't enable more checks on your implementation.</span></span>

## <a name="specify-preconditions-allownull-and-disallownull"></a><span data-ttu-id="4fd52-149">Указание предусловий: `AllowNull` и `DisallowNull`</span><span class="sxs-lookup"><span data-stu-id="4fd52-149">Specify preconditions: `AllowNull` and `DisallowNull`</span></span>

<span data-ttu-id="4fd52-150">Рассмотрим свойство для чтения и записи, которое никогда не возвращает `null`, так как имеет разумное значение по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4fd52-150">Consider a read/write property that never returns `null` because it has a reasonable default value.</span></span> <span data-ttu-id="4fd52-151">Вызывающие объекты передают `null` методу доступа set при задании ему этого значения по умолчанию.</span><span class="sxs-lookup"><span data-stu-id="4fd52-151">Callers pass `null` to the set accessor when setting it to that default value.</span></span> <span data-ttu-id="4fd52-152">Например, рассмотрим систему обмена сообщениями, запрашивающую имя экрана в комнате чата.</span><span class="sxs-lookup"><span data-stu-id="4fd52-152">For example, consider a messaging system that asks for a screen name in a chat room.</span></span> <span data-ttu-id="4fd52-153">Если имя не указано, система создает случайное значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-153">If none is provided, the system generates a random name:</span></span>

```csharp
public string ScreenName
{
   get => _screenName;
   set => _screenName = value ?? GenerateRandomScreenName();
}
private string _screenName;
```

<span data-ttu-id="4fd52-154">При компиляции предыдущего кода в контексте, игнорирующем допустимость значения NULL, не возникает никаких проблем.</span><span class="sxs-lookup"><span data-stu-id="4fd52-154">When you compile the preceding code in a nullable oblivious context, everything is fine.</span></span> <span data-ttu-id="4fd52-155">После включения ссылочных типов, допускающих значения NULL, свойство `ScreenName` преобразуется в ссылку, не допускающую значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-155">Once you enable nullable reference types, the `ScreenName` property becomes a non-nullable reference.</span></span> <span data-ttu-id="4fd52-156">Это верно для метода доступа `get`: он никогда не возвращает `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-156">That's correct for the `get` accessor: it never returns `null`.</span></span> <span data-ttu-id="4fd52-157">Вызывающим объектам не нужно проверять возвращаемое свойство на наличие значения `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-157">Callers don't need to check the returned property for `null`.</span></span> <span data-ttu-id="4fd52-158">Но теперь при задании свойству значения `null` создается предупреждение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-158">But now setting the property to `null` generates a warning.</span></span> <span data-ttu-id="4fd52-159">Чтобы включить поддержку этого типа кода, добавьте атрибут <xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute?displayProperty=nameWithType> к свойству, как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="4fd52-159">To support this type of code, you add the <xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute?displayProperty=nameWithType> attribute to the property, as shown in the following code:</span></span>

```csharp
[AllowNull]
public string ScreenName
{
   get => _screenName;
   set => _screenName = value ?? GenerateRandomScreenName();
}
private string _screenName = GenerateRandomScreenName();
```

<span data-ttu-id="4fd52-160">Чтобы использовать этот и другие атрибуты, описанные в этой статье, может потребоваться добавить директиву `using` для пространства имен <xref:System.Diagnostics.CodeAnalysis>.</span><span class="sxs-lookup"><span data-stu-id="4fd52-160">You may need to add a `using` directive for <xref:System.Diagnostics.CodeAnalysis> to use this and other attributes discussed in this article.</span></span> <span data-ttu-id="4fd52-161">Атрибут применяется к свойству,а не методу доступа `set`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-161">The attribute is applied to the property, not the `set` accessor.</span></span> <span data-ttu-id="4fd52-162">Атрибут `AllowNull` указывает *предусловия* и применяется только к входным данным.</span><span class="sxs-lookup"><span data-stu-id="4fd52-162">The `AllowNull` attribute specifies *pre-conditions*, and only applies to inputs.</span></span> <span data-ttu-id="4fd52-163">Метод доступа `get` имеет возвращаемое значение, но у него нет входных аргументов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-163">The `get` accessor has a return value, but no input arguments.</span></span> <span data-ttu-id="4fd52-164">Таким образом, атрибут `AllowNull` применяется только к методу доступа `set`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-164">Therefore, the `AllowNull` attribute only applies to the `set` accessor.</span></span>

<span data-ttu-id="4fd52-165">В предыдущем примере показано, что следует искать при добавлении атрибута `AllowNull` к аргументу.</span><span class="sxs-lookup"><span data-stu-id="4fd52-165">The preceding example demonstrates what to look for when adding the `AllowNull` attribute on an argument:</span></span>

1. <span data-ttu-id="4fd52-166">Общий контракт для этой переменной заключается в том, что она не должна принимать значение `null`, поэтому нужен ссылочный тип, не допускающий значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-166">The general contract for that variable is that it shouldn't be `null`, so you want a non-nullable reference type.</span></span>
1. <span data-ttu-id="4fd52-167">Существуют сценарии, когда выходная переменная может иметь значение `null`, однако они используются довольно редко.</span><span class="sxs-lookup"><span data-stu-id="4fd52-167">There are scenarios for the input variable to be `null`, though they aren't the most common usage.</span></span>

<span data-ttu-id="4fd52-168">Чаще всего этот атрибут будет необходим для свойств или аргументов `in`, `out` и `ref`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-168">Most often you'll need this attribute for properties, or `in`, `out`, and `ref` arguments.</span></span> <span data-ttu-id="4fd52-169">Атрибут `AllowNull` лучше всего применять в ситуации, когда переменная обычно имеет значение, отличное от NULL, но необходимо разрешить `null` в качестве предусловия.</span><span class="sxs-lookup"><span data-stu-id="4fd52-169">The `AllowNull` attribute is the best choice when a variable is typically non-null, but you need to allow `null` as a precondition.</span></span>

<span data-ttu-id="4fd52-170">Сравните этот вариант со сценариями использования `DisallowNull`: этот атрибут используется для указания того, что входная переменная ссылочного типа, допускающего значение NULL, не должна иметь значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-170">Contrast that with scenarios for using `DisallowNull`: You use this attribute to specify that an input variable of a nullable reference type shouldn't be `null`.</span></span> <span data-ttu-id="4fd52-171">Рассмотрим свойство, где `null` является значением по умолчанию, но клиенты могут задать для него только значение, отличное от NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-171">Consider a property where `null` is the default value, but clients can only set it to a non-null value.</span></span> <span data-ttu-id="4fd52-172">Рассмотрим следующий код.</span><span class="sxs-lookup"><span data-stu-id="4fd52-172">Consider the following code:</span></span>

```csharp
public string ReviewComment
{
    get => _comment;
    set => _comment = value ?? throw new ArgumentNullException(nameof(value), "Cannot set to null");
}
string _comment;
```

<span data-ttu-id="4fd52-173">Предыдущий код лучше всего демонстрирует ваше намерение выразить то, что атрибут `ReviewComment` может принимать значение `null`, но ему невозможно задать значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-173">The preceding code is the best way to express your design that the `ReviewComment` could be `null`, but can't be set to `null`.</span></span> <span data-ttu-id="4fd52-174">В коде, допускающем значения NULL, эту концепцию можно представить вызывающим объектам более четко с помощью <xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="4fd52-174">Once this code is nullable aware, you can express this concept more clearly to callers using the <xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute?displayProperty=nameWithType>:</span></span>

```csharp
[DisallowNull]
public string? ReviewComment
{
    get => _comment;
    set => _comment = value ?? throw new ArgumentNullException(nameof(value), "Cannot set to null");
}
string? _comment;
```

<span data-ttu-id="4fd52-175">В контексте, допускающем значения NULL, метод доступа `ReviewComment` `get` может возвращать значение по умолчанию, равное `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-175">In a nullable context, the `ReviewComment` `get` accessor could return the default value of `null`.</span></span> <span data-ttu-id="4fd52-176">Компилятор предупреждает, что перед доступом необходимо проверить это значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-176">The compiler warns that it must be checked before access.</span></span> <span data-ttu-id="4fd52-177">Более того, он предупреждает вызывающие объекты о том, что это может быть `null`, им не следует явно задавать его равным `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-177">Furthermore, it warns callers that, even though it could be `null`, callers shouldn't explicitly set it to `null`.</span></span> <span data-ttu-id="4fd52-178">Атрибут `DisallowNull` также задает *предварительное условие*. Он не влияет на метод доступа `get`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-178">The `DisallowNull` attribute also specifies a *pre-condition*, it doesn't affect the `get` accessor.</span></span> <span data-ttu-id="4fd52-179">Атрибут `DisallowNull` используется при отслеживании следующих моментов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-179">You use the `DisallowNull` attribute when you observe these characteristics about:</span></span>

1. <span data-ttu-id="4fd52-180">Переменная может принимать значение `null` в основных сценариях, часто при первом создании экземпляра.</span><span class="sxs-lookup"><span data-stu-id="4fd52-180">The variable could be `null` in core scenarios, often when first instantiated.</span></span>
1. <span data-ttu-id="4fd52-181">Переменной не следует явно задавать значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-181">The variable shouldn't be explicitly set to `null`.</span></span>

<span data-ttu-id="4fd52-182">Эти ситуации распространены в коде, который изначально *игнорировал допустимость значений NULL*.</span><span class="sxs-lookup"><span data-stu-id="4fd52-182">These situations are common in code that was originally *null oblivious*.</span></span> <span data-ttu-id="4fd52-183">Может быть так, что свойства объекта задаются в двух отдельных операциях инициализации.</span><span class="sxs-lookup"><span data-stu-id="4fd52-183">It may be that object properties are set in two distinct initialization operations.</span></span> <span data-ttu-id="4fd52-184">Может быть так, что некоторые свойства задаются только после завершения какой-либо асинхронной операции.</span><span class="sxs-lookup"><span data-stu-id="4fd52-184">It may be that some properties are set only after some asynchronous work has completed.</span></span>

<span data-ttu-id="4fd52-185">Атрибуты `AllowNull` и `DisallowNull` позволяют указать, что предусловия для переменных могут не соответствовать заметкам, допускающим значение NULL, для этих переменных.</span><span class="sxs-lookup"><span data-stu-id="4fd52-185">The `AllowNull` and `DisallowNull` attributes enable you to specify that preconditions on variables may not match the nullable annotations on those variables.</span></span> <span data-ttu-id="4fd52-186">Они предоставляют более подробные сведения о характеристиках API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-186">These provide more detail about the characteristics of your API.</span></span> <span data-ttu-id="4fd52-187">Эта информация помогает вызывающим объектам правильно использовать API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-187">This additional information helps callers use your API correctly.</span></span> <span data-ttu-id="4fd52-188">Помните, что для указания предусловий используются следующие атрибуты.</span><span class="sxs-lookup"><span data-stu-id="4fd52-188">Remember you specify preconditions using the following attributes:</span></span>

- <span data-ttu-id="4fd52-189">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute). Входной аргумент, не допускающий значение NULL, может принимать значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-189">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="4fd52-190">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute). Входной аргумент, допускающий значение NULL, никогда не должен принимать значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-190">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>

## <a name="specify-post-conditions-maybenull-and-notnull"></a><span data-ttu-id="4fd52-191">Указание постусловий: `MaybeNull` и `NotNull`</span><span class="sxs-lookup"><span data-stu-id="4fd52-191">Specify post-conditions: `MaybeNull` and `NotNull`</span></span>

<span data-ttu-id="4fd52-192">Предположим, у вас есть метод со следующей сигнатурой.</span><span class="sxs-lookup"><span data-stu-id="4fd52-192">Suppose you have a method with the following signature:</span></span>

```csharp
public Customer FindCustomer(string lastName, string firstName)
```

<span data-ttu-id="4fd52-193">Вероятно, вы написали такой метод для возвращения значения `null` в случае, если искомое имя не найдено.</span><span class="sxs-lookup"><span data-stu-id="4fd52-193">You've likely written a method like this to return `null` when the name sought wasn't found.</span></span> <span data-ttu-id="4fd52-194">`null` четко указывает, что запись не найдена.</span><span class="sxs-lookup"><span data-stu-id="4fd52-194">The `null` clearly indicates that the record wasn't found.</span></span> <span data-ttu-id="4fd52-195">В этом примере вы, вероятно, измените тип возвращаемого значения с `Customer` на `Customer?`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-195">In this example, you'd likely change the return type from `Customer` to `Customer?`.</span></span> <span data-ttu-id="4fd52-196">Объявление возвращаемого значения как ссылочного типа, допускающего значение NULL, четко указывает намерение этого API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-196">Declaring the return value as a nullable reference type specifies the intent of this API clearly.</span></span>

<span data-ttu-id="4fd52-197">По причинам, описанным в разделе [Универсальные определения и допустимость значений NULL](../../nullable-migration-strategies.md#generic-definitions-and-nullability), этот метод не работает с универсальными методами.</span><span class="sxs-lookup"><span data-stu-id="4fd52-197">For reasons covered under [Generic definitions and nullability](../../nullable-migration-strategies.md#generic-definitions-and-nullability) that technique doesn't work with generic methods.</span></span> <span data-ttu-id="4fd52-198">У вас может быть универсальный метод, который действует по аналогичному шаблону.</span><span class="sxs-lookup"><span data-stu-id="4fd52-198">You may have a generic method that follows a similar pattern:</span></span>

```csharp
public T Find<T>(IEnumerable<T> sequence, Func<T, bool> predicate)
```

<span data-ttu-id="4fd52-199">Нельзя указать, что возвращаемое значение — `T?`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-199">You can't specify that the return value is `T?`.</span></span> <span data-ttu-id="4fd52-200">Если искомый элемент не найден, метод возвращает `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-200">The method returns `null` when the sought item isn't found.</span></span> <span data-ttu-id="4fd52-201">Так как вы не можете объявить тип возвращаемого значения `T?`, добавьте заметку `MaybeNull` к значению, возвращаемому методом.</span><span class="sxs-lookup"><span data-stu-id="4fd52-201">Since you can't declare a `T?` return type, you add the `MaybeNull` annotation to the method return:</span></span>

```csharp
[return: MaybeNull]
public T Find<T>(IEnumerable<T> sequence, Func<T, bool> predicate)
```

<span data-ttu-id="4fd52-202">Предыдущий код информирует вызывающие объекты о том, что подразумевается тип, не допускающий значение NULL, но возвращаемое значение на самом деле *может* быть равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-202">The preceding code informs callers that the contract implies a non-nullable type, but the return value *may* actually be null.</span></span>  <span data-ttu-id="4fd52-203">Используйте атрибут `MaybeNull`, если API должен быть типом, не допускающим значение NULL (как правило, параметром универсального типа), но могут быть случаи, когда возвращается `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-203">Use the `MaybeNull` attribute when your API should be a non-nullable type, typically a generic type parameter, but there may be instances where `null` would be returned.</span></span>

<span data-ttu-id="4fd52-204">Можно также указать, что возвращаемое значение или аргумент `out` или `ref` не равны NULL, даже если тип является ссылочным типом, допускающим значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-204">You can also specify that a return value or an `out` or `ref` argument isn't null even though the type is a nullable reference type.</span></span> <span data-ttu-id="4fd52-205">Рассмотрим метод, гарантирующий достаточный размер массива для хранения ряда элементов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-205">Consider a method that ensures an array is large enough to hold a number of elements.</span></span> <span data-ttu-id="4fd52-206">Если у входного аргумента отсутствует необходимая емкость, подпрограмма выделит новый массив и скопирует в него все существующие элементы.</span><span class="sxs-lookup"><span data-stu-id="4fd52-206">If the input argument doesn't have capacity, the routine would allocate a new array and copy all the existing elements into it.</span></span> <span data-ttu-id="4fd52-207">Если входной аргумент имеет значение `null`, подсистема выделит новое хранилище.</span><span class="sxs-lookup"><span data-stu-id="4fd52-207">If the input argument is `null`, the routine would allocate new storage.</span></span> <span data-ttu-id="4fd52-208">Если имеется достаточная емкость, подпрограмма не выполняет никаких действий.</span><span class="sxs-lookup"><span data-stu-id="4fd52-208">If there's sufficient capacity, the routine does nothing:</span></span>

```csharp
public void EnsureCapacity<T>(ref T[] storage, int size)
```

<span data-ttu-id="4fd52-209">Эту подпрограмму можно вызвать следующим образом.</span><span class="sxs-lookup"><span data-stu-id="4fd52-209">You could call this routine as follows:</span></span>

```csharp
// messages has the default value (null) when EnsureCapacity is called:
EnsureCapacity<string>(ref messages, 10);
// messages is not null.
EnsureCapacity<string>(messages, 50);
```

<span data-ttu-id="4fd52-210">После включения ссылочных типов, допускающих значения NULL, необходимо убедиться, что предыдущий код компилируется без вывода предупреждений.</span><span class="sxs-lookup"><span data-stu-id="4fd52-210">After enabling null reference types, you want to ensure that the preceding code compiles without warnings.</span></span> <span data-ttu-id="4fd52-211">Когда метод возвращает значение, аргумент `storage` гарантированно не будет равен NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-211">When the method returns, the `storage` argument is guaranteed to be not null.</span></span> <span data-ttu-id="4fd52-212">Однако можно вызвать `EnsureCapacity` с пустой ссылкой.</span><span class="sxs-lookup"><span data-stu-id="4fd52-212">However, it's acceptable to call `EnsureCapacity` with a null reference.</span></span> <span data-ttu-id="4fd52-213">Можно сделать `storage` ссылочным типом, допускающим значение NULL, и добавить постусловие `NotNull` в объявление параметра.</span><span class="sxs-lookup"><span data-stu-id="4fd52-213">You can make `storage` a nullable reference type, and add the `NotNull` post-condition to the parameter declaration:</span></span>

```csharp
public void EnsureCapacity<T>([NotNull] ref T[]? storage, int size)
```

<span data-ttu-id="4fd52-214">В предыдущем коде показано четкое выражение существующего контракта. Вызывающие объекты могут передавать переменную со значением `null`, но возвращаемое значение гарантированно никогда не будет равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-214">The preceding code expresses the existing contract clearly: Callers can pass a variable with the `null` value, but the return value is guaranteed to never be null.</span></span> <span data-ttu-id="4fd52-215">Атрибут `NotNull` лучше всего подходит для аргументов `ref` и `out`, когда `null` может передаваться в качестве аргумента, но при возврате метода этот аргумент гарантированно не будет равен NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-215">The `NotNull` attribute is most useful for `ref` and `out` arguments where `null` may be passed as an argument, but that argument is guaranteed to be not null when the method returns.</span></span>

<span data-ttu-id="4fd52-216">Для указания безусловных постусловий используются следующие атрибуты.</span><span class="sxs-lookup"><span data-stu-id="4fd52-216">You specify unconditional postconditions using the following attributes:</span></span>

- <span data-ttu-id="4fd52-217">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute). Возвращаемое значение, не допускающее значение NULL, может быть равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-217">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="4fd52-218">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute). Возвращаемое значение, допускающее значение NULL, никогда не будет равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-218">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>

## <a name="specify-conditional-post-conditions-notnullwhen-maybenullwhen-and-notnullifnotnull"></a><span data-ttu-id="4fd52-219">Указание условных постусловий: `NotNullWhen`, `MaybeNullWhen` и `NotNullIfNotNull`</span><span class="sxs-lookup"><span data-stu-id="4fd52-219">Specify conditional post-conditions: `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull`</span></span>

<span data-ttu-id="4fd52-220">Вам, скорее всего, известен метод <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> `string`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-220">You're likely familiar with the `string` method <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType>.</span></span> <span data-ttu-id="4fd52-221">Этот метод возвращает `true`, если аргумент имеет значение NULL или является пустой строкой.</span><span class="sxs-lookup"><span data-stu-id="4fd52-221">This method returns `true` when the argument is null or an empty string.</span></span> <span data-ttu-id="4fd52-222">Вот форма проверки значений NULL. Если метод возвращает `false`, вызывающим объектам не требуется выполнять проверку значений NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-222">It's a form of null-check: Callers don't need to null-check the argument if the method returns `false`.</span></span> <span data-ttu-id="4fd52-223">Чтобы сделать такой метод методом, допускающим значения NULL, необходимо задать для аргумента ссылочный тип, допускающий значение NULL, и добавить атрибут `NotNullWhen`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-223">To make a method like this nullable aware, you'd set the argument to a nullable reference type, and add the `NotNullWhen` attribute:</span></span>

```csharp
bool IsNullOrEmpty([NotNullWhen(false)] string? value);
```

<span data-ttu-id="4fd52-224">В этом случае компилятор знает, что любой код, в котором возвращаемое значение равно `false`, не должен проходить проверку значений NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-224">That informs the compiler that any code where the return value is `false` doesn't need null checks.</span></span> <span data-ttu-id="4fd52-225">Добавление атрибута означает, что `IsNullOrEmpty` выполняет необходимую проверку значений NULL: когда он возвращает `false`, входной аргумент не равен `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-225">The addition of the attribute informs the compiler's static analysis that `IsNullOrEmpty` performs the necessary null check: when it returns `false`, the input argument isn't `null`.</span></span>

```csharp
string? userInput = GetUserInput();
if (!string.IsNullOrEmpty(userInput))
{
   int messageLength = userInput.Length; // no null check needed.
}
// null check needed on userInput here.
```

<span data-ttu-id="4fd52-226">Метод <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> будет помечен для .NET Core 3.0, как показано выше.</span><span class="sxs-lookup"><span data-stu-id="4fd52-226">The <xref:System.String.IsNullOrEmpty(System.String)?DisplayProperty=nameWithType> method will be annotated as shown above for .NET Core 3.0.</span></span> <span data-ttu-id="4fd52-227">В вашей базе кода могут быть аналогичные методы, которые проверяют состояние объектов на значения NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-227">You may have similar methods in your codebase that check the state of objects for null values.</span></span> <span data-ttu-id="4fd52-228">Компилятор не распознает пользовательские методы проверки значений NULL, и вам потребуется добавить заметки самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="4fd52-228">The compiler won't recognize custom null check methods, and you'll need to add the annotations yourself.</span></span> <span data-ttu-id="4fd52-229">При добавлении атрибута статический анализ компилятора знает, когда тестируемая переменная прошла проверку на наличие значения NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-229">When you add the attribute, the compiler's static analysis knows when the tested variable has been null checked.</span></span>

<span data-ttu-id="4fd52-230">Другим применением этих атрибутов является шаблон `Try*`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-230">Another use for these attributes is the `Try*` pattern.</span></span> <span data-ttu-id="4fd52-231">Постусловия для переменных `ref` и `out` сообщаются через возвращаемое значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-231">The postconditions for `ref` and `out` variables are communicated through the return value.</span></span> <span data-ttu-id="4fd52-232">Рассмотрим этот метод, показанный ранее.</span><span class="sxs-lookup"><span data-stu-id="4fd52-232">Consider this method shown earlier:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="4fd52-233">Предыдущий метод соответствует стандартному подходу .NET: возвращаемое значение указывает, было ли `message` задано найденное значение или задано значение по умолчанию, если сообщение не было найдено.</span><span class="sxs-lookup"><span data-stu-id="4fd52-233">The preceding method follows a typical .NET idiom: the return value indicates if `message` was set to the found value or, if no message is found, to the default value.</span></span> <span data-ttu-id="4fd52-234">Если метод возвращает `true`, значение `message` не равно NULL. В противном случае метод задает `message` значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-234">If the method returns `true`, the value of `message` isn't null; otherwise, the method sets `message` to null.</span></span>

<span data-ttu-id="4fd52-235">Этот принцип можно передать с помощью атрибута `NotNullWhen`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-235">You can communicate that idiom using the `NotNullWhen` attribute.</span></span> <span data-ttu-id="4fd52-236">При обновлении сигнатуры для ссылочных типов, допускающих значение NULL, задайте `message` значение `string?` и добавьте атрибут.</span><span class="sxs-lookup"><span data-stu-id="4fd52-236">When you update the signature for nullable reference types, make `message` a `string?` and add an attribute:</span></span>

```csharp
bool TryGetMessage(string key, [NotNullWhen(true)] out string? message)
```

<span data-ttu-id="4fd52-237">В предыдущем примере, когда `TryGetMessage` возвращает `true`, известно, что значение `message` не будет равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-237">In the preceding example, the value of `message` is known to be not null when `TryGetMessage` returns `true`.</span></span> <span data-ttu-id="4fd52-238">Точно так же можно добавить заметки к аналогичным методам в базе кода: аргументы могут иметь значение `null` и известно, что они не будут равны NULL при возвращении методом значения `true`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-238">You should annotate similar methods in your codebase in the same way: the arguments could be `null`, and are known to be not null when the method returns `true`.</span></span>

<span data-ttu-id="4fd52-239">Кроме того, может потребоваться еще один, последний атрибут.</span><span class="sxs-lookup"><span data-stu-id="4fd52-239">There's one final attribute you may also need.</span></span> <span data-ttu-id="4fd52-240">Иногда состояние NULL возвращаемого значения зависит от состояния NULL одного входного аргумента или нескольких.</span><span class="sxs-lookup"><span data-stu-id="4fd52-240">Sometimes the null state of a return value depends on the null state of one or more input arguments.</span></span> <span data-ttu-id="4fd52-241">Эти методы возвращают значение, отличное от NULL, если определенные входные аргументы не равны `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-241">These methods will return a non-null value whenever certain input arguments aren't `null`.</span></span> <span data-ttu-id="4fd52-242">Чтобы правильно добавить заметки к этим методам, используйте атрибут `NotNullIfNotNull`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-242">To correctly annotate these methods, you use the `NotNullIfNotNull` attribute.</span></span> <span data-ttu-id="4fd52-243">Рассмотрим следующий метод.</span><span class="sxs-lookup"><span data-stu-id="4fd52-243">Consider the following method:</span></span>

```csharp
string GetTopLevelDomainFromFullUrl(string url);
```

<span data-ttu-id="4fd52-244">Если аргумент `url` не равен NULL, выходные данные не равны `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-244">If the `url` argument isn't null, the output isn't `null`.</span></span> <span data-ttu-id="4fd52-245">После включения ссылок, допускающих значение NULL, эта подпись работает правильно при условии, если API никогда не принимает входные данные со значением NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-245">Once nullable references are enabled, that signature works correctly, provided your API never accepts a null input.</span></span> <span data-ttu-id="4fd52-246">Однако если входные данные могут иметь значение NULL, то возвращаемое значение также может иметь значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-246">However, if the input could be null, then return value could also be null.</span></span> <span data-ttu-id="4fd52-247">Сигнатуру можно заменить следующим кодом:</span><span class="sxs-lookup"><span data-stu-id="4fd52-247">You could change the signature to the following code:</span></span>

```csharp
string? GetTopLevelDomainFromFullUrl(string? url);
```

<span data-ttu-id="4fd52-248">Это работает, но вызывающим объектам придется часто проводить дополнительные проверки `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-248">That also works, but will often force callers to implement extra `null` checks.</span></span> <span data-ttu-id="4fd52-249">Контракт заключается в том, что возвращаемое значение будет равно `null` только тогда, когда входной аргумент `url` имеет значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-249">The contract is that the return value would be `null` only when the input argument `url` is `null`.</span></span> <span data-ttu-id="4fd52-250">Чтобы выразить этот контракт, можно добавить заметку к этому методу, как показано в следующем коде.</span><span class="sxs-lookup"><span data-stu-id="4fd52-250">To express that contract, you would annotate this method as shown in the following code:</span></span>

```csharp
[return: NotNullIfNotNull("url")]
string? GetTopLevelDomainFromFullUrl(string? url);
```

<span data-ttu-id="4fd52-251">Возвращаемое значение и аргумент снабжены заметкой `?`, указывающей, что каждый из них может быть равен `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-251">The return value and the argument have both been annotated with the `?` indicating that either could be `null`.</span></span> <span data-ttu-id="4fd52-252">Атрибут дополнительно уточняет, что возвращаемое значение не будет равно NULL, если аргумент `url` не принимает значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-252">The attribute further clarifies that the return value won't be null when the `url` argument isn't `null`.</span></span>

<span data-ttu-id="4fd52-253">Для указания условных постусловий используются следующие атрибуты.</span><span class="sxs-lookup"><span data-stu-id="4fd52-253">You specify conditional postconditions using these attributes:</span></span>

- <span data-ttu-id="4fd52-254">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute). Входной аргумент, не допускающий значение NULL, может иметь значение NULL, если метод возвращает указанное значение `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-254">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable input argument may be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="4fd52-255">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute). Входной аргумент, допускающий значение NULL, не будет иметь значение NULL, если метод возвращает указанное значение `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-255">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable input argument won't be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="4fd52-256">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute). Возвращаемое значение не равно NULL, если входной аргумент для указанного параметра не равен NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-256">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>

## <a name="constructor-helper-methods-membernotnull-and-membernotnullwhen"></a><span data-ttu-id="4fd52-257">Вспомогательные методы конструктора: `MemberNotNull` и `MemberNotNullWhen`</span><span class="sxs-lookup"><span data-stu-id="4fd52-257">Constructor helper methods: `MemberNotNull` and `MemberNotNullWhen`</span></span>

<span data-ttu-id="4fd52-258">Эти атрибуты определяют ваше намерение при рефакторинге общего кода из конструкторов в вспомогательные методы.</span><span class="sxs-lookup"><span data-stu-id="4fd52-258">These attributes specify your intent when you've refactored common code from constructors into helper methods.</span></span> <span data-ttu-id="4fd52-259">Компилятор C# анализирует конструкторы и инициализаторы полей, чтобы убедиться, что все ссылочные поля, не допускающие значения NULL, были инициализированы перед возвратом каждого конструктора.</span><span class="sxs-lookup"><span data-stu-id="4fd52-259">The C# compiler analyzes constructors and field initializers to make sure that all non-nullable reference fields have been initialized before each constructor returns.</span></span> <span data-ttu-id="4fd52-260">При этом компилятор C# не следит за назначениями полей с помощью всех вспомогательных методов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-260">However, the C# compiler doesn't track field assignments through all helper methods.</span></span> <span data-ttu-id="4fd52-261">Компилятор выдает предупреждение `CS8618`, когда поля инициализируются не непосредственно в конструкторе, а в вспомогательном методе.</span><span class="sxs-lookup"><span data-stu-id="4fd52-261">The compiler issues warning `CS8618` when fields aren't initialized directly in the constructor, but rather in a helper method.</span></span> <span data-ttu-id="4fd52-262">Вам нужно добавить <xref:System.Diagnostics.CodeAnalysis.MemberNotNullAttribute> в объявление метода и указать поля, которые инициализируются значением, отличным от NULL, в методе.</span><span class="sxs-lookup"><span data-stu-id="4fd52-262">You add the <xref:System.Diagnostics.CodeAnalysis.MemberNotNullAttribute> to a method declaration and specify the fields that are initialized to a non-null value in the method.</span></span> <span data-ttu-id="4fd52-263">Рассмотрим следующий пример.</span><span class="sxs-lookup"><span data-stu-id="4fd52-263">For example, consider the following example:</span></span>

:::code language="csharp" source="snippets/InitializeMembers.cs" ID="MemberNotNullExample":::

<span data-ttu-id="4fd52-264">В конструкторе `MemberNotNull` атрибута можно указать несколько имен полей в качестве аргументов.</span><span class="sxs-lookup"><span data-stu-id="4fd52-264">You can specify multiple field names as arguments to the `MemberNotNull` attribute constructor.</span></span>

<span data-ttu-id="4fd52-265"><xref:System.Diagnostics.CodeAnalysis.MemberNotNullWhenAttribute> имеет аргумент `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-265">The <xref:System.Diagnostics.CodeAnalysis.MemberNotNullWhenAttribute> has a `bool` argument.</span></span> <span data-ttu-id="4fd52-266">`MemberNotNullWhen` используется в ситуациях, когда вспомогательный метод возвращает тип `bool`, указывающий, инициализированы ли поля вспомогательного метода.</span><span class="sxs-lookup"><span data-stu-id="4fd52-266">You use `MemberNotNullWhen` in situations where your helper method returns a `bool` indicating whether your helper method initialized fields.</span></span>

## <a name="verify-unreachable-code"></a><span data-ttu-id="4fd52-267">Проверка недостижимого кода</span><span class="sxs-lookup"><span data-stu-id="4fd52-267">Verify unreachable code</span></span>

<span data-ttu-id="4fd52-268">Некоторые методы, как правило, это вспомогательные методы исключений или другие служебные методы, всегда завершают работу, вызывая исключение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-268">Some methods, typically exception helpers or other utility methods, always exit by throwing an exception.</span></span> <span data-ttu-id="4fd52-269">Или вспомогательный метод может вызвать исключение на основе значения логического аргумента.</span><span class="sxs-lookup"><span data-stu-id="4fd52-269">Or, a helper may throw an exception based on the value of a Boolean argument.</span></span>

<span data-ttu-id="4fd52-270">В первом случае можно добавить атрибут `DoesNotReturn` в объявление метода.</span><span class="sxs-lookup"><span data-stu-id="4fd52-270">In the first case, you can add the `DoesNotReturn` attribute to the method declaration.</span></span> <span data-ttu-id="4fd52-271">Компилятор предлагает три способа.</span><span class="sxs-lookup"><span data-stu-id="4fd52-271">The compiler helps you in three ways.</span></span> <span data-ttu-id="4fd52-272">Во-первых, компилятор выдает предупреждение, если есть возможность выйти из метода без вызова исключения.</span><span class="sxs-lookup"><span data-stu-id="4fd52-272">First, the compiler issues a warning if there's a path where the method can exit without throwing an exception.</span></span> <span data-ttu-id="4fd52-273">Во-вторых, компилятор помечает любой код после вызова этого метода как *недостижимый* до тех пор, пока не будет обнаружено соответствующее предложение `catch`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-273">Second, the compiler marks any code after a call to that method as *unreachable*, until an appropriate `catch` clause is found.</span></span> <span data-ttu-id="4fd52-274">В третьих, недостижимый код не влияет на состояния со значением NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-274">Third, the unreachable code won't affect any null states.</span></span> <span data-ttu-id="4fd52-275">Рассмотрим этот метод:</span><span class="sxs-lookup"><span data-stu-id="4fd52-275">Consider this method:</span></span>

```csharp
[DoesNotReturn]
private void FailFast()
{
    throw new InvalidOperationException();
}

public void SetState(object containedField)
{
    if (!isInitialized)
    {
        FailFast();
    }

    // unreachable code:
    _field = containedField;
}
```

<span data-ttu-id="4fd52-276">Во втором случае добавьте атрибут `DoesNotReturnIf` к логическому параметру метода.</span><span class="sxs-lookup"><span data-stu-id="4fd52-276">In the second case, you add the `DoesNotReturnIf` attribute to a Boolean parameter of the method.</span></span> <span data-ttu-id="4fd52-277">Предыдущий пример можно изменить следующим образом.</span><span class="sxs-lookup"><span data-stu-id="4fd52-277">You can modify the previous example as follows:</span></span>

```csharp
private void FailFast([DoesNotReturnIf(false)] bool isValid)
{
    if (!isValid)
    {
        throw new InvalidOperationException();
    }
}

public void SetState(object containedField)
{
    FailFast(isInitialized);

    // unreachable code when "isInitialized" is false:
    _field = containedField;
}
```

## <a name="summary"></a><span data-ttu-id="4fd52-278">Сводка</span><span class="sxs-lookup"><span data-stu-id="4fd52-278">Summary</span></span>

[!INCLUDE [C# version alert](../../includes/csharp-version-alert.md)]

<span data-ttu-id="4fd52-279">Добавление ссылочных типов, допускающих значения NULL, предоставляет исходный словарь для описания ожиданий API для переменных, которые могут иметь значение `null`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-279">Adding nullable reference types provides an initial vocabulary to describe your APIs expectations for variables that could be `null`.</span></span> <span data-ttu-id="4fd52-280">Атрибуты позволяют более подробно описывать состояние NULL для переменных в качестве предусловий и постусловий.</span><span class="sxs-lookup"><span data-stu-id="4fd52-280">The attributes provide a richer vocabulary to describe the null state of variables as preconditions and postconditions.</span></span> <span data-ttu-id="4fd52-281">Эти атрибуты более четко описывают ожидания и обеспечивают более эффективную работу специалистов, использующих ваши API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-281">These attributes more clearly describe your expectations and provide a better experience for the developers using your APIs.</span></span>

<span data-ttu-id="4fd52-282">При обновлении библиотек для контекста, допускающего значение NULL, добавьте эти атрибуты, чтобы пользователи могли правильно использовать ваши API.</span><span class="sxs-lookup"><span data-stu-id="4fd52-282">As you update libraries for a nullable context, add these attributes to guide users of your APIs to the correct usage.</span></span> <span data-ttu-id="4fd52-283">С помощью этих атрибутов вы можете полностью описывать состояние NULL входных аргументов и возвращаемых значений.</span><span class="sxs-lookup"><span data-stu-id="4fd52-283">These attributes help you fully describe the null-state of input arguments and return values:</span></span>

- <span data-ttu-id="4fd52-284">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute). Входной аргумент, не допускающий значение NULL, может принимать значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-284">[AllowNull](xref:System.Diagnostics.CodeAnalysis.AllowNullAttribute): A non-nullable input argument may be null.</span></span>
- <span data-ttu-id="4fd52-285">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute). Входной аргумент, допускающий значение NULL, никогда не должен принимать значение NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-285">[DisallowNull](xref:System.Diagnostics.CodeAnalysis.DisallowNullAttribute): A nullable input argument should never be null.</span></span>
- <span data-ttu-id="4fd52-286">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute). Возвращаемое значение, не допускающее значение NULL, может быть равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-286">[MaybeNull](xref:System.Diagnostics.CodeAnalysis.MaybeNullAttribute): A non-nullable return value may be null.</span></span>
- <span data-ttu-id="4fd52-287">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute). Возвращаемое значение, допускающее значение NULL, никогда не будет равно NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-287">[NotNull](xref:System.Diagnostics.CodeAnalysis.NotNullAttribute): A nullable return value will never be null.</span></span>
- <span data-ttu-id="4fd52-288">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute). Входной аргумент, не допускающий значение NULL, может иметь значение NULL, если метод возвращает указанное значение `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-288">[MaybeNullWhen](xref:System.Diagnostics.CodeAnalysis.MaybeNullWhenAttribute): A non-nullable input argument may be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="4fd52-289">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute). Входной аргумент, допускающий значение NULL, не будет иметь значение NULL, если метод возвращает указанное значение `bool`.</span><span class="sxs-lookup"><span data-stu-id="4fd52-289">[NotNullWhen](xref:System.Diagnostics.CodeAnalysis.NotNullWhenAttribute): A nullable input argument won't be null when the method returns the specified `bool` value.</span></span>
- <span data-ttu-id="4fd52-290">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute). Возвращаемое значение не равно NULL, если входной аргумент для указанного параметра не равен NULL.</span><span class="sxs-lookup"><span data-stu-id="4fd52-290">[NotNullIfNotNull](xref:System.Diagnostics.CodeAnalysis.NotNullIfNotNullAttribute): A return value isn't null if the input argument for the specified parameter isn't null.</span></span>
- <span data-ttu-id="4fd52-291">[DoesNotReturn](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnAttribute). Метод никогда не возвращает значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-291">[DoesNotReturn](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnAttribute): A method never returns.</span></span> <span data-ttu-id="4fd52-292">Другими словами, он всегда создает исключение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-292">In other words, it always throws an exception.</span></span>
- <span data-ttu-id="4fd52-293">[DoesNotReturnIf](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnIfAttribute). Этот метод никогда не возвращает значение, если связанный параметр `bool` имеет указанное значение.</span><span class="sxs-lookup"><span data-stu-id="4fd52-293">[DoesNotReturnIf](xref:System.Diagnostics.CodeAnalysis.DoesNotReturnIfAttribute): This method never returns if the associated `bool` parameter has the specified value.</span></span>
